name: Deno CI
  on: [push, pull_request]
jobs:
  build:
    name: '${{ matrix.kind }} ${{ matrix.os }}'
    runs-on: '${{ matrix.os }}'
    if: '!contains(github.event.head_commit.message, ''[skip ci]'')'
    strategy:
      matrix:
        os:
          - macOS-latest
          - ubuntu-latest
          - windows-latest
    env:
      GH_ACTIONS: true
      DENO_BUILD_MODE: release
      V8_BINARY: true
      APP_ID: 12345
      API_KEY: RGAPI-TEST
      API_BASE_URL: 'https://www.example.com/apis/'
      STATIC_BASE_URL: 'https://www.example.com/static/'
      CACHE_DIR: ./.cache
    steps:
      - uses: actions/checkout@v2
      - name: Setup Deno
        uses: denolib/setup-deno@master
        with:
          deno-version: 1.x
      - name: Tests
        run: deno test test/ --allow-read --allow-env --allow-net
